<html>
<head>
    <title>Voting Game</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- <base href="https://www.stonybrook.edu/commcms/cbpe/games/"> -->
<script type="text/javascript"></script>

<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
<script>
//Global Variables Declared

var isMobile = false; //initiate as false
// device detection




var mTurkVersion = false;
var playerID = "ID" + Math.random().toString().substring(2,7);
window.parent.postMessage(playerID, "*");
var timerSpeed = 800;
var numberOfVillagers = 9; // variable for total number of villagers in game, including player;
var numberOfRounds = 5;
var sharedBerries = 0;
var totalFound = 0;
var bushCountSetting = 5; //max number of bushes for the day
var foundBerries = [0, 0, 0, 0, 0, 0, 0, 0, 0];   //total number of berries found from all bushes by each villager in a day
var foundBerries2 = [0, 0, 0, 0, 0, 0, 0, 0, 0];   //after-tax number of berries (used for calculation)
var foundBerries3 = [0, 0, 0, 0, 0, 0, 0, 0, 0];   //after-tax number of berries (used for calculation)
var counter = 0;
var heartCounter = 0;
var vilIncome = [10,10,5,5,10,10,5,5];
var p1Income = [10,10,10,10,10,5,5,5,5,5];
var bushOrder = [1,2,3,4,5]
var taxOutcomeHigh = 0.6;
var taxOutcomeLow = 0.2;
var correctHigh = 0;
var correctLow = 0;
var shareTime= 10;
var selfishVote = 1; // probability that each bot votes in their self interest
var dailyAverage = 0; // group income average for the day
var voteOutcome = 0;
var tally = 0;
var totalDays = 0;
var bushCount = 0;
var bushBerries = 0; //berries in a single bush
var totalPoints = 60;
var metabolism = 5;
var countdown = 60;
var p1Change =0;
var vChange = [0, 0, 0, 0, 0, 0, 0, 0];
var distValue = 0;
var reduceVal = 0;
var communityBasket = 0;
var iCOM = 0; //counter of berries in each basket
var iBasket =0;
var xString = "";
var x1String = "";
var yString = "";
var plus = [ "", "", "", "", "", "", "", "", ""];
var MTURKID = "No MturkID Given";

// Game Version:
    //  0 = "sharing"
    //  1 = "taxes"
var gameVersion = "vgPol";


function element(id){ return document.getElementById(id); } //To Simplify code
window.onload=function(){ //As window loads

  if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
isMobile = true;
}

  if(isMobile == true){
  show("mobile");	//MTurk-mode

} else {
  element("mobile").style.display="none";
}



    if(mTurkVersion == true){
		show("welcome");	//MTurk-mode

	} else {
		element("welcome").style.display="none";


	}
	var counter = 0;
    var correctHigh = 0;
    var correctLow = 0;
    var shareTime= 0;
    var dailyAverage = 0; // group income average for the day
    var voteOutcome = 0;
    var totalDays = 0;
    var bushCount = 0;
    var bushBerries = 0;
    var totalPoints = 60;
    var countdown = 60;
    setTimeout(function() {show('instructions1');
                          healthBar();  }, 700);
    setTimeout(function() {classChange('button1', 'fadingIn', 'fadingOut');}, 500);
     setTimeout(function() { show('startTbl'); }, 1700);
}
//Shuffle Function
function shuffle(array) {
	var currentIndex = array.length, tempVal, randomIndex;
	while (0 !== currentIndex) {
		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;
		tempVal = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = tempVal;
	}
	return array;
}
//Hide & Show functions
function classChange(id, class1, class2){
	var divelement = element(id);
	divelement.classList.remove('hide', 'show', 'hideSlow', 'fadingIn','fadingInline','fadingOut');
	divelement.classList.add(class1);
    if (class1 == "fadingOut"){
		setTimeout(function() { divelement.classList.add('hide');}, 400);}
}
function turnPage(hidepage, showpage){
	if (hidepage != ''){ element(hidepage).style.display="none"; }
	if (showpage != ''){ element(showpage).style.display="block"; }
}
function numFormat(id, class1){
    var elem = element(id);
    elem.classList.remove("neutral","negative","positive");
    elem.classList.add(class1);
}
function show(id){
    element(id).style.display='block';
}
function hide(id){
	element(id).style.display='none';
}
function visible(id){
    var divelement = element(id);
        divelement.style.visibility = 'visible';
         divelement.style.display='inline';
}
function invisible(id){
    var divelement = element(id);
        divelement.style.visibility = 'hidden';
         divelement.style.display='inline';
}
function hideChanges(){ //Hides Change column in scorboard
    for (var i=1; i<numberOfVillagers; i++){
        var ii = [i + 1];
        /*invisible('berry'+[i]);*/
        element('p'+ ii +'Change').innerHTML ="";
	}
    /*invisible('berry');*/
	element('p1Change').innerHTML ="";
}
//User submits mturk ID
function getMTurkId() {
    // Get the value of the input field with id="MTurkId"
    var x = element("MTurkId").value;
    // Validate MTurk code
     if (x.length < 6 || x.length > 6){
		element("validation").innerHTML = "Input not valid";
    } else {
		//Hide welcome, show Join Game page using turnpage
		turnPage("welcome","startPage");
		MTURKID = x;
		//Send mturk worker ID to firebase
		var y = {MTurkId: x, timeStamp: Firebase.ServerValue.TIMESTAMP};
		lobbyRef.child('Workers').push(y);
    }
}
function begin(){
    shuffle(bushOrder);
    totalDays++;
	//console.log(p1Income);
    shuffle(p1Income);
    hide('startTbl');
    invisible('button4');
    fadeOutEffect('popupTbl3');
    classChange('instructionsBttn', 'fadingIn', 'fadingOut');
    setTimeout(function(){

		//element('bush1').style.display = "block";

    setTimeout(function(){classChange('bush' + bushOrder[0],'fadingIn', 'hide');}, 0);
    setTimeout(function(){classChange('bush' + bushOrder[1],'fadingIn', 'hide');}, 500);
    setTimeout(function(){classChange('bush' + bushOrder[2],'fadingIn', 'hide');}, 1000);
    setTimeout(function(){classChange('bush' + bushOrder[3],'fadingIn', 'hide');}, 1500);
    setTimeout(function(){classChange('bush' + bushOrder[4],'fadingIn', 'hide');}, 2000);

        timer(); //console.log("totalDays = " + totalDays);
    }, 2000);
}
function flashPoints(id, id2){ //ADP: you are calling this function just once. If you cannot think of using it at least twice, you can just put the code directly where you need to use it. Do not build functions just to separate code. You can use comments and nice indentation to distinguish what you are doing.
	var divelement = element(id).id;
	var divelement2 = element(id2); console.log('divelement2 ==' + divelement2);
	classChange(divelement, 'show', 'hide');
	classChange(divelement, 'showInline', 'hide');
	divelement2.innerHTML = "$" + bushBerries + " "; console.log('divelement2.innerHTML ==' + divelement2.innerHTML + '; flash divelement == ' + divelement);
	setTimeout(function() { classChange(divelement, 'hide', 'show');}, 950);
}
// Fade Out Animation
function fadeOutEffect(id) {
    var fadeTarget = element(id);
    var fadeEffect = setInterval(function () {
        if (!fadeTarget.style.opacity) {
            fadeTarget.style.opacity = 1;
        }
        if (fadeTarget.style.opacity > 0) {
            fadeTarget.style.opacity -= 0.1;
        } else {
            clearInterval(fadeEffect);
        }
    }, 20);
    setTimeout(function(){classChange(id, 'fadingOut', 'fadingIn');}, 1000);
    setTimeout(function() {fadeTarget.style.opacity= 1;}, 2100);
}
function opacity1(id){
      var opacityTarget = element(id);
      opacityTarget.style.opacity= 1;
}
//Throbbing animation
function pulse(id) {
    var divelement = element(id);
    divelement.classList.add('grow');
    function setDisplay(){
        divelement.classList.remove('grow');
    }
    setTimeout(setDisplay, 1020);
    }
function shrink(id){
    var divelement = element(id);
    divelement.classList.add('shrink');
    function setDisplay(){
        divelement.classList.remove('shrink');
    }
    setTimeout(setDisplay, 1020);
}
//Displays Player's Found Berries
function search1(){
    iBasket++;
    if (Number.isInteger(iBasket/5) == true){
        x1String += "<img id='berrySaved" + iBasket + "'src=CSS/dollarStack.png class='berries'>";
      }
    element("findBasket").innerHTML =  x1String;
    element('foundBerry').innerHTML = ' $' +iBasket;
    element('foundBerries2').innerHTML = ' $' +iBasket;
    element('p1Berries').innerHTML = '$' + iBasket;
	if (iBasket < foundBerries[0]){
         search1();
        }
    }
function reduce(){ //console.log('foundBerries[0] == ' + foundBerries[0] + '; reduceVal == ' + reduceVal);
	yString = "";
  if (Number.isInteger(iBasket/5) == true){
	   yString = "<img id='berrySaved" + (iBasket+5) + "'src=CSS/dollarStack.png class='berries'>";
   }

    element("findBasket").innerHTML = x1String;
    var VAL = (foundBerries2[0]-1);
    iBasket--;
        if (iBasket >= VAL){
          x1String = x1String.replace(yString, '');
           reduce();}
        if (iBasket < VAL){
            iBasket++;
			element("totalPoints").innerHTML =' ' + totalPoints;
			element("iconPoints").innerHTML = ' ' +totalPoints;
			element('foundBerry').innerHTML = ' $' +foundBerries2[0];
			element('foundBerries2').innerHTML = ' $' +foundBerries2[0];
			healthBar();
		}
}
function collect(){ //animates berries or dollars being returned to player
    if (Number.isInteger(iBasket/5) == true){
      x1String += "<img id='berrySaved" + iBasket + "'src=CSS/dollarStack.png class='berries'>";
    }
    iBasket++;
    element("findBasket").innerHTML = x1String;
    element('foundBerry').innerHTML = ' $' +foundBerries3[0];
    element('foundBerries2').innerHTML = ' $' +foundBerries3[0];
    element('p1Berries').innerHTML = ' $' +foundBerries3[0];
	if (iBasket < foundBerries3[0]){ // changed to foundberries3 [0] from foundberries[0]
        collect();
	   }
	element("findBasket").innerHTML = x1String;
    }
function communityShare(){ // animates player tax collection into central fund
for (var i=0; i<communityBasket; i++){
      (function(i){
  setTimeout(function() {
    xString += "<img id='basketSaved" + i + "'src=CSS/dollarStack.png class='comBerries'>";
    xString = xString.replace(yString, '');
    element("comBasket").innerHTML = xString;
  }, shareTime*i);
  }(i));
	}
}
function communityDistribute(){
  for (var i=0; i<communityBasket; i++){
      (function(i){
  setTimeout(function() {
    console.log('comDist "begin" running...;' + ' i == ' + [i]);
    iCOM = 0;
    yString = "";
    yString = "<img id='basketSaved" + [i] + "'src=CSS/dollarStack.png class='comBerries'>";
    console.log('ystring == ' + yString);
    xString = xString.replace(yString, '');
    element("comBasket").innerHTML = xString;
  }, shareTime*i);
  }(i));
	}
}
//Simulate Villager Income: Calculates the basket icon for players depending on the amount of berries players have, separately for all villagers
function vBasketCalc(){
    for (var i=0; i<numberOfVillagers; i++){
        var round5berries = 5*Math.ceil(foundBerries[i]/5); //console.log('foundBerry' + i + '==' + foundBerries[i]);
        round5berries = round5berries / 5;
        element('basket'+i).src="CSS/dollar" + round5berries + ".png";
	}
}

function villageVoteShare(){
  for (var i=1; i<numberOfVillagers; i++){
        var chg = [i-1];
        vChange[chg] = vChange[chg] - (foundBerries[i]*shareVal); //console.log('vChange[' + [chg] + '] == ' + vChange[chg] + '; tax' + [i1] + ' running...' + '; vChangePlayer' + [player] + ' = ' + vChange[chg]);
        foundBerries[i]= foundBerries[i]-(foundBerries[i]*shareVal);
        vBasketCalc();
      }
}
function villageRedistribute(){
    setTimeout(function() {
        var player = [i1 + 1];
        var chg = [i1 - 1];
        /*visible('berry' + [i1]); //console.log('p' + player + 'Change = ' + vChange[chg]);*/
        element('p' + player + 'Change').innerHTML = plus[i1] + vChange[chg];
        element('p' + player + 'Berries').innerHTML = ' $' + foundBerries3[i1];
        pulse('p' + player + 'Berries'); shrink('basket' + [i1]);
        vBasketCalc();
        i1++;
        vChange[chg] = 0;
        if (i1<numberOfVillagers){
            villageRedistribute();
		}
	}, 100);
}
function resetVillage(){
    xString = ""; p1Change = 0; p1Change = 0;
    numFormat('p1Change', 'neutral');
    element('p1Change').innerHTML = "";
    for (var i=1; i<numberOfVillagers; i++){
        foundBerries[i] = 0;
    }
    for (var i=2; i<10; i++){
		element('p'+[i]+'Change').innerHTML = "";
        numFormat('p'+[i]+'Change', 'neutral');
    }
}
//Health Bar
function healthBar(){
    var hpoints= totalPoints; //console.log('healthbar is running...');
	var c = element("myCanvas");
	var ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);
	var grd = ctx.createLinearGradient(0, 0, 100, 0);
	grd.addColorStop(0, "crimson");
	grd.addColorStop(0.2, "orange");
	grd.addColorStop(0.3, "yellow");
	grd.addColorStop(0.45, "chartreuse");
	grd.addColorStop(0.6, "lime");
	grd.addColorStop(0.8, "limegreen");
	grd.addColorStop(1, "green");
	ctx.fillStyle = grd;
	ctx.fillRect(0, 0, (hpoints), 25);
    }
function timer(){
	countdown--;
	if (countdown > 54) { //console.log('countdown = ' + countdown);
		totalPoints=totalPoints-metabolism;
		healthBar();
    	element("totalPoints").innerHTML = " " + totalPoints;
        element("iconPoints").innerHTML = " " + totalPoints; //console.log('countdown = ' + countdown);
        pulse('heart1');
    }
    if (countdown == 54){
        healthBar();
        element("totalPoints").innerHTML = " " + totalPoints;
        element("iconPoints").innerHTML = " " + totalPoints;
	}
    if (countdown < 54 && bushCount == bushCountSetting){

        setTimeout(function() {
		clearTimeout(t);
		bushCount = 0;

        classChange('popupTbl3', 'fadingIn', 'fadingOut');
		classChange('voteScreen', 'fadingIn', 'fadingOut');
		classChange('voting', 'fadingIn', 'fadingOut');
		 //console.log("bushCount == bushCountSetting");
   }, 2000);
	}
    t=setTimeout(timer,timerSpeed);
}
//Development Settings Buttons
function roundCount(value){
    numberOfRounds += value;
    if (numberOfRounds == 0){
    numberOfRounds ++;}
    element("rounds").innerHTML = numberOfRounds;
    }
function bushCounter(value){
    if (bushCountSetting != 1 && bushCountSetting < 5){
        bushCountSetting += value;}
    if (bushCountSetting ==1){
        if (value==1){bushCountSetting += value;}}
    if (bushCountSetting ==5){
        if (value== -1){bushCountSetting += value;}}
    element("bushCountSetting1").innerHTML = bushCountSetting;
    }
function robotVoting(){
    var selfInt = slider4.value;
    selfishVote = (selfInt)/100;
    element("selfInterestPercent").innerHTML = Math.round(selfishVote * 100); //console.log('selfishVote = ' + selfishVote);
}
function v1chk(){
  element('v1').checked = true;
}
function v2chk(){
  element('v2').checked = true;
}

//Eating Berries
function eatBerries(){ //console.log('foundBerries[0] == ' + foundBerries[0] + '; counter ==' + counter + ';  iBasket ==' + iBasket); //consolidating the console logs into one
  if (Number.isInteger(foundBerries3[0]/5) == true){
    yString = "<img id='berrySaved" + foundBerries3[0] + "'src=CSS/dollarStack.png class='berries'>";
  }
    x1String = x1String.replace(yString, '');
    totalPoints++;
    element("findBasket").innerHTML = x1String;
    foundBerries3[0]--;
    counter++;
    heartCounter++;
    element("totalPoints").innerHTML = ' ' +totalPoints;
    element("iconPoints").innerHTML = ' ' +totalPoints;
    element('foundBerry').innerHTML = ' $' +foundBerries3[0];
    element('foundBerries2').innerHTML = ' $' +foundBerries3[0];
    healthBar();
    if (heartCounter ==5){
      pulse('heart1');
      heartCounter = 0;
    }
    if (counter < iBasket){
             setTimeout(function() {eatBerries();}, 100);}
    if (counter == iBasket){
        classChange('ogBasket', 'fadingIn', 'fadingOut');
          setTimeout(function(){fadeOutEffect('eatTbl3')}, 1500);
        heartCounter = 0;
        counter = 0;
        iBasket = 0;
        setTimeout(function(){
			if (numberOfRounds != totalDays){ //begin continueCheck
				classChange('eatTbl1', 'fadingIn', 'fadingOut');
			}
			if (numberOfRounds == totalDays){

				setTimeout(function(){
					element('final').innerHTML =totalPoints;
					classChange('finalTbl', 'fadingIn', 'fadingOut');
				}, 1000);
			element("code").innerHTML = playerID;
			} //end continueCheck
		}, 3000);
    }
}

function finishedClick(){
    fadeOutEffect('finalTbl');
    fadeOutEffect('gameTbl');
    fadeOutEffect('instructionsBttn');
    fadeOutEffect('dist');
    fadeOutEffect('dist2');
    fadeOutEffect('voteComp');
    fadeOutEffect('voteHead');
		hideChanges();invisible('button4');
    fadeOutEffect('dist3');
    fadeOutEffect('dist4');
    fadeOutEffect('dist5');
    fadeOutEffect('dist6');
    fadeOutEffect('popupTbl3');
    fadeOutEffect('redistribute');
		resetVillage();
    fadeOutEffect('energyBar');
    fadeOutEffect('scoreTbl');
		invisible('button1');
		setTimeout(function(){
		classChange('surveyPage1', 'fadingIn', 'fadingOut');}, 500);
}



//Firebase
    var BASE_URL = 'https://sharinggame10.firebaseio.com/';
    var lobbyRef = new Firebase(BASE_URL);
    var sharingData = {};
    //This sends data to firebase via the push command
function submitSurvey(){
      fadeOutEffect('surveyPage3');
  		turnPage('surveyPage3','bye');
}
//This will mean storing the data locally.
function storeData(){
	sharingData[totalDays] = {totalDays: totalDays, foundBerries0: foundBerries[0], voteVal: voteVal, voteTally:tally, totalPoints: totalPoints, playerID: playerID, voteOutcome: voteOutcome, gameVersion: gameVersion};
    }
//This function looks into data stored at firebase by storeData, so format needs to match
function getData(){
	   lobbyRef.child('Records').once("value", function(snapshot) {
            var data = snapshot.val();
            var csvString = "player,day,preVoteScore,found,playerVote,voteTally,voteOutcome, gameVersion\n";
		for (x in data){
			var days = data[x].days;
			for (i in days){
			if(data[x].survey != undefined) {
				csvString += data[x].survey.playerID + "," + days[i].totalDays + "," + days[i].totalPoints + "," + days[i].foundBerries0 + "," +  days[i].voteVal + "," + days[i].voteTally + "," + days[i].voteOutcome + "," + days[i].gameVersion + "\n";
			}	}
		}
		csvString += "player, MTurkId, correctHigh, correctLow, DecisionHow,GovBenefits,GovTaxes,PayTaxes,Ideology,PID,President,Gender,Age,Ethnicity,AnyComments,FinalScore,Time,gameVersion\n";
		for (x in data){
			if(data[x].survey != undefined){
				csvString += data[x].survey.playerID + "," + data[x].survey.MTurkID + "," + data[x].survey.CorrectHigh + "," + data[x].survey.CorrectLow + "," +  data[x].survey.Q1 + "," + data[x].survey.Q2 + "," + data[x].survey.Q3 + "," + data[x].survey.Q4 + "," + data[x].survey.Q5 + "," +  data[x].survey.Q7 + "," + data[x].survey.Q8 + "," + data[x].survey.Q9 + "," + data[x].survey.Q10 + "," + data[x].survey.Q11 + ","+ data[x].survey.finalScore + "," + data[x].survey.TimeStamp +  "," + data[x].survey.gameVersion + "\n";
			     }
		      }
		//if this breaks, put into a setTimeout
		download(csvString);
	   });
    }
function download(csvString){
	csvString = encodeURI(csvString);
	var a = document.createElement('a');
	a.href = 'data:attachment/csv,' + csvString;
	a.target = '_blank';
	a.download = 'myFile1.csv';
	document.body.appendChild(a);
	a.click();
    }
//Onclick Functions**************************************************
 function  bushClick(id){
     var divelement = element(id).id; //console.log('divelement == ' + divelement);
     bushCount++;
     classChange(divelement, 'hide', 'fadingIn');
     if (bushCount ==1){ //Set Variance and Income Levels for Player
		classChange('ogBasket', 'hideSlow', 'fadingIn');}
	bushBerries = p1Income[totalDays-1];
	for (var i=1; i < numberOfVillagers; i++){ //villager search function
		var vilNum = [i] - 1;
		foundBerries[i] = foundBerries[i] + vilIncome[vilNum];
		element('p' + [i+1] + 'Berries').innerHTML = ' $' + foundBerries[i];
	}
	vBasketCalc();
	foundBerries[0] = foundBerries[0] + bushBerries;
    search1();
    flashPoints(divelement +'flash', divelement + 'flasha');  //this makes points flash above bushes upon click
}

function voteClick(){ //this is the major voting, taxing, and redistribution function of the game.
  // Voting
  	var voteSelection = document.querySelector('input[name = "voteShare"]:checked').value; //begin groupVote
    if (voteSelection == 0 || voteSelection == 1){
    for (var i=0; i< numberOfVillagers; i++){ //Calculate Villager Average
		    dailyAverage = dailyAverage + foundBerries[i];
    }
    dailyAverage = dailyAverage/numberOfVillagers; //console.log('dailyAverage == ' + dailyAverage);
    show('outcome');
    invisible('outcome');
    invisible('button4');
    fadeOutEffect('voting');
		voteVal = parseInt(voteSelection);
 // Tallying Vote
		var vVote = 0;
		for (var i=1; i<numberOfVillagers; i++){
		   var vote = 0;
			var above = 0;
			var prob = Math.random();
			if (foundBerries[i] >= dailyAverage){
				if(prob < selfishVote){
                    vote = 0;}
                if(prob > selfishVote){
                    vote = 1;}}
            if (foundBerries[i] <= dailyAverage){
				if(prob < selfishVote){
                    vote = 1;}
                if(prob > selfishVote){
                    vote = 0;}}
              vVote = vVote + vote;
		}
		tally = (voteVal + vVote);
		if (tally > 4){ voteOutcome = taxOutcomeHigh; shareTime = 60;
                    element('animal').src="CSS/dem.png";}
		if (tally < 5){ voteOutcome = taxOutcomeLow; shareTime = 150;
                    element('animal').src="CSS/rep.png";}  //end groupVote
		if (voteVal == 0){ //begin correctCount
			if (foundBerries[0] > 33){
				correctHigh ++;}
		}
		if (voteVal == 1){
			if (foundBerries[0] < 33){
				correctLow ++;}
		}
		var moreVote = tally;
		var lessVote = numberOfVillagers-tally;
		var outcome = "";
		if (voteOutcome == taxOutcomeLow){
			shareVal = 0.2;
			outcome = "Republican President, low taxes";}
		if (voteOutcome == taxOutcomeHigh){
			shareVal = 0.6;
			outcome = "Democratic President, high taxes";}
		element('voteMore').innerHTML = moreVote;
		element('voteLess').innerHTML = lessVote;
		element('outcomeVote').innerHTML = outcome;
        setTimeout(function(){
		classChange('redistribute', 'fadingIn', 'fadingOut');
		classChange('voteComp', 'fadingIn', 'fadingOut');
		classChange('voteHead', 'fadingIn', 'fadingOut');
		storeData();
	}, 1500);
    setTimeout(function(){visible('outcome');
                        classChange('outcome', 'fadingInline', 'fadingOut');
	}, 2000);


  // ######################## Tax Calculations: ########################
  for (var i = 0; i< numberOfVillagers; i++){
    totalFound = totalFound + foundBerries[i];
    }
  sharedBerries = Math.round(shareVal * totalFound);
  communityBasket = Math.round(sharedBerries / 6);
  element('sharedBerries').innerHTML = sharedBerries;
  reduceVal = Math.round(foundBerries[0] * shareVal);
  foundBerries2[0]= (foundBerries[0] - reduceVal);
  p1Change = p1Change - reduceVal;
  for (var i=1; i<numberOfVillagers; i++){
        foundBerries2[i]= foundBerries[i]-(foundBerries[i]*shareVal);
      }
  distValue = sharedBerries/numberOfVillagers;
  distValue = Math.round(distValue);
  foundBerries3[0] = Math.round(foundBerries2[0] + distValue); // begin redistributing
  p1Change = (foundBerries3[0] - foundBerries[0]);
  if (p1Change > 0){
    numFormat('p1Change', "positive");
    plus[0] = "+ $"}
  if (p1Change < 0){
     p1Change = Math.abs(p1Change);
     numFormat('p1Change', "negative");
     plus[0] = "- $";}
  for (var i=1; i<(numberOfVillagers); i++){
       var chg = [i-1];
       var pnum = [i+1];
       foundBerries3[i]= foundBerries2[i] + distValue;
       vChange[chg] = (foundBerries3[i] - foundBerries[i]);
       console.log('###############################');
       console.log('foundberries = ' + foundBerries);
       console.log('foundberries3 = ' + foundBerries3);
       console.log('vChange = ' + vChange);
       console.log('###############################');

       if (vChange[chg] > 0){
           numFormat('p' + pnum + 'Change', "positive");
           plus[i] = "+ $"}
       if (vChange[chg]< 0){
           numFormat('p' + pnum + 'Change', 'negative');
           vChange[chg] = Math.abs(vChange[chg]);
           plus[i] = "- $";}
         }

 // ######################## Tax Animations: ############################
    setTimeout(function(){
		  classChange('dist', 'fadingIn', 'fadingOut');
		  classChange('allBaskets', 'fadingIn', 'fadingOut');

		  setTimeout(function(){
			       communityShare();
			       element('shared').innerHTML = reduceVal;
			       reduce();
			      for (var i=0; i<(numberOfVillagers); i++){ //Removed from village VoteShare
                (function(i){
                  setTimeout(function() {
                    var pnum = i + 1;
                    element('p' + pnum + 'Berries').innerHTML = ' $' + foundBerries2[i];
                    pulse('basket' + i);
                    pulse('p' + pnum + 'Berries');
                    var test = 'basket' + i;
                    console.log('basket[i]  =' + test);
                    console.log('pPNUMChange = ' + 'p'+ pnum + 'Change');
                    element('p'+ pnum +'Change').innerHTML ="";
                      vBasketCalc();
                  }, 100*i);
                }(i));
              }
        			setTimeout(function() {
        				classChange('dist3', 'fadingIn', 'fadingOut'); classChange('dist4', 'fadingIn', 'fadingOut');
        			}, 3000);
        			element('foundBerry').innerHTML = ' $' +foundBerries2[0];
        			element('foundBerries2').innerHTML = ' $' +foundBerries2[0];
        			element('distVal').innerHTML = distValue;
    }, 500);
	}, 3000);

            // redistribution calculations begin here

    setTimeout(function(){fadeOutEffect('dist');}, 6000);
    setTimeout(function(){classChange('dist2', 'fadingIn', 'fadingOut'); }, 7100);
    setTimeout(function(){

		collect();
		communityDistribute();
		iBasket = foundBerries3[0];
		element('p1Berries').innerHTML = ' $' +foundBerries3[0];
		pulse('basket0');
		element('distVal2').innerHTML = distValue;
		element('netChange').innerHTML = (plus[0] + p1Change);
		element('p1Change').innerHTML =(plus[0] +p1Change);
		vBasketCalc();
		i1 = 1;
		villageRedistribute();
		element('foundBerry').innerHTML = ' $' +foundBerries3[0];
		element('foundBerries2').innerHTML = ' $' +foundBerries3[0];
		setTimeout(function() {fadeOutEffect('allBaskets'); fadeOutEffect('dist2'); }, 5000);
		setTimeout(function() {classChange('dist5', 'fadingIn', 'fadingOut');}, 1500);
		setTimeout(function() {classChange('dist6', 'fadingIn', 'fadingOut');}, 4000);
		setTimeout(function() {classChange('eatTbl3', 'fadingIn', 'fadingOut');}, 6000);
		setTimeout(function(){eatBerries();}, 7000);
		vBasketCalc();
	}, 7000);
}}
function newDayClick(){
  yString = "";
  xString = "";
  element("comBasket").innerHTML = xString;
  classChange('allBaskets', 'hide', 'fadingOut');
  opacity1('allBaskets');
  element('v1').checked = false;
  element('v2').checked = false;
  shuffle(bushOrder);
	totalFound = 0;
  fadeOutEffect('dist');
  fadeOutEffect('dist2');
  fadeOutEffect('voteComp');
  fadeOutEffect('voteHead');
    setTimeout(function(){
		invisible('outcome');
		classChange('outcome', 'fadingOut', 'fadingIn');
	}, 2000);
    hideChanges();
    for (var i=0; i<(numberOfVillagers); i++){
        foundBerries[i] = 0;
        foundBerries2[i] = 0;
        foundBerries3[i] = 0;
      }
    invisible('button4');
	classChange('dist3', 'fadingOut', 'fadingIn');
	classChange('dist4', 'fadingOut', 'fadingIn');
	classChange('dist5', 'fadingOut', 'fadingIn');
	classChange('dist6', 'fadingOut', 'fadingIn');
	classChange('popupTbl3', 'fadingOut', 'fadingIn');
	classChange('redistribute', 'fadingOut', 'fadingIn');
    resetVillage();
    classChange('eatTbl1', 'fadingOut', 'fadingIn');
    countdown = 60;
    totalDays++;
	element("dayCounter").innerHTML = totalDays;
    x1String = "";
      setTimeout(function(){
        setTimeout(function(){classChange('bush' + bushOrder[0],'fadingIn', 'hide');}, 0);
        setTimeout(function(){classChange('bush' + bushOrder[1],'fadingIn', 'hide');}, 500);
        setTimeout(function(){classChange('bush' + bushOrder[2],'fadingIn', 'hide');}, 1000);
        setTimeout(function(){classChange('bush' + bushOrder[3],'fadingIn', 'hide');}, 1500);
        setTimeout(function(){classChange('bush' + bushOrder[4],'fadingIn', 'hide');}, 2000);
		/*classChange('energyBar', 'fadingIn', 'fadingOut');
		classChange('instructionsBttn', 'fadingIn', 'fadingOut');
		classChange('scoreTbl', 'fadingIn', 'fadingOut');*/
		timer(); healthBar();
	}, 1000);
}
</script> <!-- ******************************END JAVASCRIPT********************************** -->
<style type="text/CSS">
body {
 font-family: Tahoma;
    font-size:16px;	font-size:16px;
	vertical-align:top;
	background-color:#609fce;
	-webkit-touch-callout: none; /* iOS Safari */
	-webkit-user-select: none;   /* Chrome/Safari/Opera */
	-khtml-user-select: none; /* Konqueror */
	-moz-user-select: none;  /* Firefox */
	-ms-user-select: none; * IE/Edge */
	user-select: none; /* non-prefixed, not supported by any browser */
}
.greetings {
	position: absolute;
	top:0%;
	height: 100%;
	width: 100%;
	font-size:16px;
    background-color:#fffaf0;
    text-align:center;
	z-index: 8;
	border: 5px solid #286090;
}
.greetings2 {
	position: absolute;
  top:0%;
  height: 100%;
  width: 100%;
	font-size:16px;
    background-color:#fffaf0;
    text-align:center;
	z-index: 8;
	border: 5px solid #286090;
}
.instructions{
 	font-family: Tahoma;	font-size:16px;
	size: 12px;
	position: absolute;
	border-radius: 25px;
	width: 600px;
	min-height: 520px;
	top: 10px;
	left:25%;
	border-style: solid;
	border-width: 3px;
	border-color: #96c769;
	box-shadow: 7px 7px 12px rgba(48, 90, 122, 0.8);
	background-color: #fffaf0;
	padding: 18px;
	display:none;
	z-index:7;
}

.job{
  width:55px;
}
@keyframes fadeIn {
	from {opacity: 0;}
	to {opacity:1;}
}
@keyframes fadeOut {
	from {opacity: 1;}
	to {opacity:0;}
}
.hideSlow{
  transition: opacity 0.5s ease-out;
    opacity: 0;
}
.fadingOut{
	animation-name: fadeOut 0.5 !important;
	animation-duration: 0.5s!important;
}
.fadingIn{
	display:block !important;
	-webkit-animation: fadeIn 0.5s linear !important;
	animation-name: fadeIn ;!important;
	animation-duration: 0.5s ;!important;
}
.fadingInline{
     display: inline !important;
    -webkit-animation: fadeIn 0.5s linear !important;
    animation-name: fadeIn ;!important;
       animation-duration: 0.5s ;!important;
}
.show{
	display: block !important;
}
.showInline{
	display: inline-block!important;
}
.hide{
    display: none !important;
}
.positive{
   color:limegreen;
}
.negative{
	color:firebrick;
}
.neutral{
	color:black;
}
.grow {
	-webkit-animation: CSSGrow 0.3s ease-out, CSSShrink 0.3s ease-out,  CSSGrow 0.3s ease-out, CSSShrink 0.3s ease-out;
}
.shrink {
     -webkit-animation: CSSShrink2 0.5s ease-out, CSSGrow2 0.5s ease-out, CSSShrink2 0.5s ease-out, CSSGrow2 0.5s ease-out;
}
@-webkit-keyframes CSSGrow {
	from {
		-webkit-transform: scale(1);
	}
	to {
		-webkit-transform: scale(1.5);
		}
}
@-webkit-keyframes CSSShrink {
	from {
		-webkit-transform: scale(1.5);
	}
	to {
		-webkit-transform: scale(1);
	}
}
@-webkit-keyframes CSSShrink2 {
	from {
		-webkit-transform: scale(1);
	}
	to {
		-webkit-transform: scale(0.8);
	}
}
@-webkit-keyframes CSSGrow2 {
	from {
		-webkit-transform: scale(0.8);
	}
	to {
		-webkit-transform: scale(1);
	}
}
.tables {
	border-radius: 25px;
	border-style: solid;
	border-width: 3px;
}
#gameTbl{
    top: 20px;
    position: absolute;
    width: 760px;
    height: 410px;
    left: 127px;
    border-color:#701300;
    box-shadow: 7px 7px 12px rgba(48, 90, 122, 0.8);
    background-image: url(CSS/wallpaperCity.png);
    background-size: 100% 100%;
}
.lowerTitleA{
	font-size:14px;
	padding-right: 9px;
	padding-left:9px;
	padding-top:1px;
	padding-bottom:1px;
	text-align: center;
	border-color: #5a90b8;
	border-radius: 100px;
	:pointer;
}
.lowerTitleB{
	text-align: center;
	border-color: #5a90b8;
	border-radius: 100px;
	: default;
   }
#scoreboard td{
	width: 30px;
    padding: 1px;
    padding: 1px; 4px; 1px; 4px;
    text-align: center;
    border-bottom: 1px solid #ddd;
}
#scoreboard {
    border-collapse: collapse;
	position: relative;
}
#energyBar {
	position: relative;
  border-collapse: separate;
	top: 2px;
	width: 350px;
	height: 34px;
	border-radius: 40px;
	border-color: #701300;
	border-style: solid;
	border-width: 1px;
	padding: 0px;
	margin-left: auto;
	margin-right: auto;
	background-color: antiquewhite;
	font-weight: bold;
	background-color: rgba(255, 250, 240, 0.6);
}
#findBasket{
	width:140px;
	height: 120px;
	-moz-transform: scaleY(-1);
	-o-transform: scaleY(-1);
	-webkit-transform: scaleY(-1);
	transform: scaleY(-1);
	filter: FlipV;
	-ms-filter: "FlipV";
  }
#comBasket{
	width:250px;
	position: absolute;
	-moz-transform: scaleY(-1);
	-o-transform: scaleY(-1);
	-webkit-transform: scaleY(-1);
	transform: scaleY(-1);
	filter: FlipV;
	-ms-filter: "FlipV";
}
.berries{
	width: 40px;
	-moz-transform: scaleY(-1);
	-o-transform: scaleY(-1);
	-webkit-transform: scaleY(-1);
	transform: scaleY(-1);
	filter: FlipV;
	-ms-filter: "FlipV";
	position:relative;
	z-index: inherit;
}
.comBerries{
	width:28px;
	-moz-transform: scaleY(-1);
	-o-transform: scaleY(-1);
	-webkit-transform: scaleY(-1);
	transform: scaleY(-1);
	filter: FlipV;
	-ms-filter: "FlipV";
	position:static;
	z-index: inherit;
}
#startTbl{
	position: relative;
	width: 165px;
	height: 85px;
	font-size:22px;
	border-color:#701300;
	background-color:antiquewhite;
	padding: 9px;
	:pointer;
	display:none;
	z-index:5;
}
#eatTbl1{
	position: absolute;
	border-radius: 25px;
	font-family: Tahoma;
	font-size:22px;
	top: 170px;
	left: 276px;
	padding: 9px;
}
#popupTbl3{
	position: relative;
	width: 700px;
	height: 350px;
	table-layout: fixed;
	top: 62px;
	border-color: #701300;
	background-color: #fffaf0;
	padding-top: 5px;
	padding-left: 10px;
	padding-right: 10px;
	-moz-focus-inner {
		border: 0;
		padding: 0;
		margin:0;
	}
}
#settingsTable{
	position: absolute;
	width: 160px;
	height: 500px;
	left: -60px;
	border-color:#701300;
	background-color:antiquewhite;
	padding: 1px;
	display:none;
}
#settingsBttn{
	position: absolute;
	top:430px;
	left: 150px;
	font-size:15px;
	margin:0;
	text-align: center;
	border-color: #5a90b8;
	border-radius: 100px;
}
#instructionsBttn{
	position: absolute;
	top:470px;
	left: 740px;
	font-size:15px;
	margin:0;
	text-align: center;
	border-color: #5a90b8;
	border-radius: 100px;
}
#finalTbl{
    position: relative;
    width: 250px;
    height: 200px;
    top: 150px;
	border-color:darkgreen;
    background-color:darkseagreen;
    padding: 18px;
    z-index: 1;
}
#blueBorder{
	border-style: solid;
	border-width: 1px;
	border-color:#2558ff;
	border-radius: 20px;
	padding: 3px;
}
@keyframes Rising{
	0%   {opacity:0; transform: translate3d(0, 0, 0);}
	25%  {opacity:.8; transform: translate3d(15%, -25%, 0);}
	50%  {opacity:1; transform: translate3d(30%, -50%, 0);}
	75%  {opacity:1; transform: translate3d(45%, -75%, 0);}
	95%  {opacity:0.2; transform: translate3d(55%, -95%, 0);}
	100% {opacity:0; transform: translate3d(60%, -100%, 0);}
}
@-webkit-keyframes Rising { /* Safari and Chrome */
	0%   {opacity:0; transform: translate3d(0, 0, 0);}
	25%  {opacity:.8; transform: translate3d(15%, -25%, 0);}
	50%  {opacity:1; transform: translate3d(30%, -50%, 0);}
	75%  {opacity:1; transform: translate3d(45%, -75%, 0);}
	95%  {opacity:0.2; transform: translate3d(55%, -95%, 0);}
	100% {opacity:0; transform: translate3d(60%, -100%, 0);}
}
#scoreTbl {
    table-layout: fixed;
    position: absolute;
    width: 360px;
    height: 165px;
    top: 433px;
    left: 322px;
    box-shadow: 7px 7px 12px rgba(48, 90, 122, 0.8);
    box-shadow: 7px 7px 12px r;
    border-color: #701300;
    box-shadow: 7px 7px 12px r;
    box-shadow: 7px 7px 12px r;
    background-color: #fffaf0;
    padding: 5px;
    padding-left: 10px;
}
.topVote{
    vertical-align:top;
    font-family: Tahoma;
    font-size: 17px;
    text-align: center;
}
.villagerIcon {
    font-size: 17px;
    text-align: center;
	width:16px;
	max-height:15px;
}
.flashScore{
	   color: #96c769;
	-webkit-text-stroke-width: 1px;
	-webkit-text-stroke-color: #024d02;
	font-weight: bold;
	font-size: 30px;
	position: absolute;
	-webkit-animation: Rising 1s linear;
	-moz-animation: Rising 1s linear;
	animation: Rising 1s linear;
	:default;
}
</style>
</head>
<body>
<!--Welcome page-->
<div id="welcome" name="welcomeNAME" class="greetings" style="display:none">
	<h2 style="color:#337ab7">Welcome to the Voting Game</h2>
	<p> Please enter your ID number:</p><input type="text" name="MTURKINPUT" id="MTurkId">
	<button type="button" class="btn btn-success" onclick="getMTurkId();">Submit</button>
	<p id="validation" style="color:orangeRed"></p>
  <span id="testOutput" style="color: green"></span>
</div>

<div id="mobile" name="mobileNAME" class="greetings2" style="display:none">
	<h2 style="color:#337ab7; font-size:60px;"><br><br><br>Welcome to the Voting Game</h2>
	<p style="font-size:44px; padding:50px;"> This demo has not been formatted for mobile devices. Please open the game on a desktop or laptop computer. <br><br>☼
</div>

		<div id ="startPage" style = "position:relative; margin: auto; width: 1020px;">
			<div id="gameTbl" class = "tables" style="display:none">
				<table id="energyBar" style="display:none">
          <tr>
						<td style="width:190px; text-align: center; vertical-align:top; padding-top:2;"><img src='CSS/heart2.png' id="heart1" style="width:30px; padding-left:5px"><span id="totalPoints" style="font-size:18">60</span></td>
						<td style="width:126px;">&nbsp;<canvas id="myCanvas" style="visibility:visible; padding-top:3px" width="100" height="41" ></canvas></td>
						<td style="width:180px; text-align: center; vertical-align:top;"><div style="padding-top:5; padding-right:5;"><b>Round: </b><span id="dayCounter">1</span></div></td></tr>
				</table>


				<div id ="bush1flash" class="flashScore hide" style=" top: 307px; left: 295px; " draggable="false"><div id="bush1flasha" ></div></div>
<!--bush1-->	<img src="CSS/job.png" id="bush1" class="hide job" style = "position: absolute; top: 307px; left: 295px; cursor: pointer;" draggable="false" onclick="bushClick('bush1');"></img>
				<div id ="bush4flash" class="flashScore hide" style = "top: 265px; right: 165px;" draggable="false"><span id="bush4flasha" ></span></div>
<!--bush4-->	<img src="CSS/job.png" id="bush4" class="hide job" style = "position: absolute; top: 265px; right: 165px;  cursor: pointer;" draggable="false" onclick=" bushClick('bush4');"></img>
				<div id ="bush3flash" class="flashScore hide" style = "top: 247px; left: 347px;" draggable="false"><span id="bush3flasha" ></span></div>
<!--bush3-->	<img src="CSS/job.png" id="bush3" class="hide job" style = "position: absolute; top: 247px; left: 347px; cursor: pointer;" draggable="false" onclick="bushClick('bush3');"></img>
				<div id ="bush2flash" class="flashScore hide" style= " top: 305px; right: 250px; " draggable="false"><span id="bush2flasha" ></span></div>
<!--bush2-->	<img src="CSS/job.png" id="bush2" class="hide job" style = "position: absolute; top: 305px; right: 250px; cursor: pointer;" draggable="false" onclick="bushClick('bush2');"></img>
				<div id ="bush5flash" class="flashScore hide" style = "top: 260px; right: 70px;" draggable="false"><span id="bush5flasha"></span></div>
<!--bush5-->	<img src="CSS/job.png" id="bush5" class="hide job" style = "position: absolute; top: 260px; right: 70px; cursor:pointer;" draggable="false" onclick="bushClick('bush5');"></img>





				</td></tr>
			</div>  <!--Instructions -->
				<div id= "instructions1" class = "instructions">
					<h2 style= "text-align:center";><b>Overview</b></h2>
					In this game, you are a citizen of the United States who lives in a city.<br><br>
					You are one of nine citizens who survive by earning money <img src="CSS/dollar.png" style="width:22px;"> to boost their health <img src="CSS/heart.png" style="width:15px; height:14px;">.
					<br><br>Each round, the citizens set out on their own to find jobs that earn them money. Afterwards, they meet to vote for the next president based on each candidate's policy for taxing income.
					<br><br>You will be one of the citizens and the other eight citizens will be played by the computer. The computer will make decisions for the citizens similar to how people make decisions in this game.
					<br><br>At the end of the game, you will earn <font color="green">1 cent</font> per point of your final health score. This money will be paid to you as a <b>bonus</b> through your panel company.
					<center><br><button  id='button1' style="bottom: 38px; "class="lowerTitleA" onclick="turnPage('instructions1','instructions2');"> Next --></button></center>
				</div>
				<div id= "instructions2" class = "instructions">
					<h2 style= "text-align:center";><b>Searching for Jobs</b></h2>
					<p>Each round you search for jobs by clicking on job ads.<p>
					<br><center><img src="CSS/job.png" style="height:85px;"></center>
                    <br> Some rounds, you find jobs with a low pay of $25, and some rounds you find jobs with a high pay of $50. To be exact, you have a 50% chance of earning $25 and a 50% chance of earning $50. The computer will use these chances to determine how much money you earn each round.<br>
                    <br>When you find jobs, your earnings appear in your bank account.
					<br><br><center><button  id='button21' style=" bottom: 38px;" class="lowerTitleA"  onclick="turnPage('instructions2','instructions1');"><-- Back </button>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="button2" style=" bottom: 38px;" class="lowerTitleA"onclick="turnPage('instructions2','instructions3');"> Next --> </button></center>
				</div>
				<div id= "instructions3" class = "instructions">
					<h2 style= "text-align:center";><b>Health</b></h2>
                   You will start with 60 health points.<br><br><center><img src="CSS/healthbar.png" style="width:300px; border-radius:25px;"></center><br><br> Each round, your health decreases by 35 health points from the energy your body consumes through metabolism.<br>

					<br>You can add to your health points by consuming food that you buy with money. Each dollar adds 1 health point. <br><br>   <br>
					<center> <button  id='button34' style=" bottom: 38;" class="lowerTitleA"  onclick="turnPage('instructions3','instructions2');"> <-- Back</button>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="button3" style="bottom: 38; " class="lowerTitleA" onclick="turnPage('instructions3','instructions4'); "> Next --></button></center>
				</div>
				<div id= "instructions4" class = "instructions">
					<h2 style= "text-align:center";><b>Voting and Taxes </b></h2>
					<p>After the citizens search for jobs, they hold a national election to vote on the next president. Each candidate proposes a different tax policy that will be enacted if they are elected.</p>
					<p>There are two candidates on the ballot:</p>
						<ul><li>Republican Candidate <img src="CSS/rep.png" style="width: 19px;">, Low Taxes: Each citizen is taxed $1 per $5 they earn (20%).</li>
							<li>Democratic Candidate <img src="CSS/dem.png" style="width: 19px;">, High Taxes: Each citizen is taxed $3 per $5 they earn (60%).</li>
						</ul>
					<p>The candidate that receives the most votes is elected president and their tax rule is enacted. The rule is automatically applied to all of the citizens by deducting money from each citizen's bank account according to the rule.</p>

					<br><center> <button  id='button31' style=" bottom: 38;" class="lowerTitleA"  onclick="turnPage('instructions4','instructions3'); "> <-- Back</button>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="button3" style="bottom: 38; " class="lowerTitleA" onclick="turnPage('instructions4','instructions5'); "> Next --></button></center>
				</div>
				<div id= "instructions5" class = "instructions">
					<h2 style= "text-align:center";><b>Distributing Benefits and Buying Food</b></h2>
				<br>After voting, the money collected by the government is divided equally among the nine citizens and distributed to their bank accounts.
        <br><center><img src="CSS/irs.png" style="width:250px;"></center>
          <br>At the end of the round, each citizen spends their money on food to gain health points. Then they continue to the next round for a total of 10 rounds.
					<br><br><br><center> <button  id='button3d1' style=" bottom: 38;" class="lowerTitleA"  onclick="turnPage('instructions5','instructions4');"><-- Back</button>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="button3d" style="bottom: 38; " class="lowerTitleA" onclick="turnPage('instructions5','instructions6'); "> Next --></button></center>
				</div>
				<div id= "instructions6" class = "instructions">
					<h2 style= "text-align:center";><b>Summary</b></h2>
					<ul><li>  You start with 60 health points and you lose 35 each round due to metabolism.</li>
                        <li> Each round, you have equal chances of earning $25 or $50.</li>
						<li>You and the other citizens vote for the Republican candidate who proposes low taxes ($1 per $5 of income) or the Democratic candidate who proposes high taxes ($3 per $5 of income).</li>
						<li>The candidate that receives the most votes is elected president and their tax rule is enacted. Money is collected by the government according to the rule and then it is divided equally among the nine citizens.</li>
						<li>After the money is divided, you buy food to add to your health and proceed to the next round.</li>
						<li>The game continues for 10 rounds. You will earn 1 cent per point of your final health score, paid to you as a bonus through your panel company.<br><br>
					</ul>
					<p>You can refer to these instructions at any point during the game by clicking the "Instructions" button.</p>
					<center><button class="lowerTitleA" id='button4d2' style=" bottom: 38; " onclick="turnPage('instructions6','instructions5');"><-- Back</button>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button id="buttonClose" style="bottom: 38;" class="lowerTitleA" onclick="hide('instructions6'); show('gameTbl'); show('energyBar'); show('scoreTbl');">Close</button>
					</center>
				</div> <!--Score Table-->
			<div id='scoreTbl' class = "tables" style="display:none;" >
				<div style="position:absolute; left:30; top:10;"><text>
					<div align="left">
						<img src="CSS/heart.png" style="width:15px; height:14px;"><span id="iconPoints"> 60</span><br>
						<img src="CSS/dollar.png" style="width:18px;"><span id="foundBerries2">$0</span>
					</div></text><text class="villagerIcon"><br><center><img src="CSS/villlager1.png" style="height: 70px;" draggable="false"><b> <text style="visibility:hidden">abcdefgi</text> </b></center></text>
				</div><center>
				<tr><th style="padding:0">
				    <hr width="2" size="145" style="position:absolute; top:0px; left:115px;">
					<img src="CSS/bank.png"  style="height: 150px; width:160px; position:absolute; top:5px; right:85px; z-index:1" draggable="false" >
					<img src="CSS/bank.png"  style="height: 150px; width:160px; position:absolute; top:5px; right:85px; z-index: 3;" draggable="false" >
					<img src="CSS/bank.png" id="ogBasket" style="height: 150px; width:160px; position:absolute; top:5px; right:85px; z-index: 4;" draggable="false" >
					<div id="findBasket" style="position:absolute; z-index: 3; top:25px; right:96px; border: 0px solid blue;"></div>
					<div style="position:absolute; top:67px; right:24px;" align="left"><span id="foundBerry" style="font-size:36px; color:forestgreen;">$0</span></div></th>
				</tr></center>
			</div> 			<center>
			<div id='startTbl' class = 'tables' style="top:180px;" onclick="begin();"><center>Click Here To Begin!</center></div></center>
			<table id="settingsTable" class = "tables">  <!-- settings buttons -->
				 <tr><td>
				<center><h2>Settings</h2></center><hr>
				<div style ="font-size:15px">
					<b>Robot Error %<br></b>
					<input id="slider4" type="range" value="20" min="0" max="100" step="1" onchange="robotVoting();"><span id='selfInterestPercent'>20</span>%<br><br>
					<b>Number of Rounds:</b><br>
					<button class="lowerTitleA" onclick="roundCount(-1);">-</button>
					<button class="lowerTitleA" onclick="roundCount(1);">+</button><br>
					Rounds in game: <i><span id="rounds">10</span></i><br><br>
					<b>Bushes Searched Daily:</b><br>
					<button class="lowerTitleA" onclick="bushCounter(-1);">-</button>
					<button class="lowerTitleA" onclick="bushCounter(1);">+</button><br>
					# of Bushes : <i><span id="bushCountSetting1">5</span></i><br><br>
					<b>Download Data File<br></b>
					<button class="lowerTitleA" onclick="getData();">Data</button><br><br><br>
					<center><button class="lowerTitleA" onclick="fadeOutEffect('settingsTable');">Hide Settings</button></center>
				</div><br></td></tr>
			</table>
			<button id="settingsBttn" style="display:none;" onclick="classChange('settingsTable', 'fadingIn', 'fadingOut');">Settings</button>
			<button id="instructionsBttn" style="display:none" onclick="show('instructions1');">Instructions</button>

		<center><table id='popupTbl3' class = "tables" style="display:none"><tr>  <!--Large Eating and Redistributing Table -->
			<td colspan="2" style="width:100%">
				<div id='eatTbl3' style="display:none; position: absolute; border-radius: 25px; font-size:22px; top: 115px; left: 256px; padding: 9px;"><center>Buying food <br> to gain health...
                   <br><br><img src="CSS/food.png" style="height: 135px"></center></div>
                <center>
			<div id='eatTbl1' style="display:none; position:absolute; max-width:240px; top:140px; left:230px; :pointer;" onclick="newDayClick();"><center>Click here to begin a new round! <br> <img src='CSS/3-2-sun-png-clipart.png' style="height:60px; :pointer;"></center></div>
                    <div id='finalTbl' class='tables' style="display:none; position:absolute; top:130px; left:227px; box-shadow: 22px 12px 12px #55555596; :pointer;" onclick="finishedClick();"><center><div id = "gameOver"><text style = "font-size:23px; font-family: Tahoma; margin:0; text-align: center;">Congratulations!</text><br><br><text>You finished the game with <br><img src="CSS/heart.png" style="width:15px; height:14px;">&nbsp;<b><span id='final'></span></b>&nbsp;Health Points!</text><br><br><i>~Please click here to continue to a short survey~</i></div></center></div></center>
			<div id='allBaskets' class="hide">
				<img src="CSS/irs.png" style=" height: 195px; position:absolute; bottom:0px; left:205px; z-index:1" draggable="false">
				<div id="comBasket" style="position:absolute; z-index: 2; bottom:60px; left:250px; border: 0px solid blue;"></div>
				<img src="CSS/irs2.png"  style=" height: 195px; position:absolute; bottom:0px; left:205px; z-index: 3;" draggable="false">
			</div>
			<div id="voteScreen" style="display:none;"><text style="visibility:hidden">abcdefghijklmnopqrstuvwxyz I am making this to take up space so that the table will occupy the entire area. asdfasdfasdf</text>
				<div style="position:absolute; top:0px; left:15px">
                    <table id="scoreboard" style = "vertical-align: top">
				<tr><td><text class="topVote"><center><b>Citizen</b></center></text></td>
					<td><div style="overflow: auto; width: 72px;"></div><text class="topVote"><center><b>Money</b></center></text></td>
					<td><div style="overflow: auto; width: 52px;"></div><text class="topVote"><center><b>Change</b></center></text></td></tr>
<!--Villager 1-->	<center><tr><td><text class="villagerIcon"><div id = "blueBorder"><img src="CSS/villlager1.png" style=" height: 27px;"draggable="false"></div></text></td>
					<td><text class="villagerIcon"><img id="basket0" src="CSS/basket.png" style="width: 27px;"><span id="p1Berries">0</span></text></td>
					<td><text class="topVote"><span id="p1Change"></span></text></td></tr>
<!--Villager 2-->	<tr><td><text class="villagerIcon"><img src="CSS/villlager2.png" style=" height: 27px;"draggable="false"></text></td>
					<td><text class="villagerIcon"><img id="basket1" src="CSS/basket.png" style="width: 27px; "><span id="p2Berries">0</span></text></td>
					<td><text class="topVote"><span id="p2Change"></span></text> <span class ="villagerContribution" id="v1chg" style="display:none; ">0</span></td></tr>
<!--Villager 3-->	<tr><td><text class="villagerIcon"><img src="CSS/villlager3.png" style=" height: 27px;"draggable="false"></text></td>
					<td><text class="villagerIcon"><img id="basket2" src="CSS/basket.png" style="width: 27px;"><span id="p3Berries"size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p3Change"></span></text><span class="villagerContribution" id="v2chg" style="display:none;">0</span></td></tr>
<!--Villager 4-->	<tr><td> <text class="villagerIcon"><img src="CSS/villlager4.png" style=" height: 27px;"draggable="false"></text></td>
					<td><text class="villagerIcon"><img id="basket3" src="CSS/basket.png" style="width: 27px;"><span id="p4Berries"size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p4Change"></span></text><span class="villagerContribution"  style="display:none; ">0</span></td></tr>
<!--Villager 5-->	<tr><td><text class="villagerIcon"><img src="CSS/villlager5.png" style=" height: 27px;"draggable="false"></text></td>
					<td> <text class="villagerIcon"><img id="basket4" src="CSS/basket.png" style="width: 27px;"><span id="p5Berries"size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p5Change"></span></text><span class="villagerContribution" id="v4chg" style="display:none; ">0</span></td></tr>
<!--Villager 6-->	<tr><td> <text class="villagerIcon"><img src="CSS/villlager6.png" style=" height: 27px;"draggable="false"></text></td>
					<td> <text class="villagerIcon"><img id="basket5" src="CSS/basket.png" style="width: 27px; "><span id="p6Berries"size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p6Change"></span></text><span class="villagerContribution" id="v5chg" style="display:none; ">0</span></td></tr>
<!--Villager 7-->	<tr><td><text class="villagerIcon"><img src="CSS/villlager7.png" style=" height: 27px;"draggable="false"></text></td>
					<td> <text class="villagerIcon"><img id="basket6" src="CSS/basket.png" style="width: 27px; "><span id="p7Berries" size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p7Change"></span></text><span class="villagerContribution" id="v6chg" style="display:none; ">0</span></td></tr>
<!--Villager 8-->	<tr><td> <text class="villagerIcon"><img src="CSS/villlager8.png" style=" height: 27px;" draggable="false"></text></td>
					<td> <text class="villagerIcon"><img id="basket7" src="CSS/basket.png" style="width: 27px; "><span id="p8Berries"size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p8Change"></span></text><span class="villagerContribution" id="v7chg" style="display:none; ">0</span></td></tr>
<!--Villager 9-->	<tr><td> <text class="villagerIcon"><img src="CSS/villlager9.png" style=" height: 27px;"draggable="false"></text></td>
					<td><text class="villagerIcon"><img id="basket8" src="CSS/basket.png" style="width: 27px; "><span id="p9Berries"size="20px;">0</span></text></td>
					<td><text class="topVote"><span id="p9Change"></span></text></td></tr></center></text>
				</table></div>
			 <!--Village Vote -->
			<div id="voting" style='padding:4px; width: 360px;height: 310px;position: absolute;left: 260px;top: 20px;display: block;border-width: 2px; border-radius:10px; border-style: dashed;padding: 15;border-color: #96c769;'>
				 <p style = "font-size:27px; font-family: Tahoma; margin:0; text-align: center;" >Presidential Election</p><br>
				<font class="lowerTitleB"><input type="radio" name="voteShare" id="v1" value="0"  onchange="v1chk(); visible('button4');" style=":pointer;"> <b>Republican Candidate <img src="CSS/rep.png" style="width: 19px; margin-right:2px;">, Low Taxes </b><br><font style="max-width:250px; position:relative; left:25px;"> Each citizen is taxed $1 per <br>$5 they earn (20%).<br><br><br></font>
				<input type="radio" name="voteShare" id="v2" value="1"  onchange="v2chk(); visible('button4');" style=":pointer;"> <b>Democratic Candidate <img src="CSS/dem.png" style="width: 20px;">, High Taxes </b><br><font style="max-width:250px; position:relative; left:25px;"> Each citizen is taxed $3 per <br> $5 they earn (60%). <br></font></font> <!--<font> tag is not supported in HTML5. Use CSS instead. See W3Schools.com for further details.-->
				<br><br><center><button class="lowerTitleA" id="button4" style="visibility:hidden; z-index:1;" onclick="voteClick();"> Vote!</button><br></center>
			</div>   <!--Redistribution-->
			<div id="redistribute" style=' padding:4px; display: none; width: 410px; position: absolute; left: 234px;top: 0px;'>
				<div style="border-style: solid;background-color: #fff0ed;border-width: 2px;border-color: #701300;border-radius:25px;padding:9px;">
					<div id="voteComp" style="display:none"><p id="lowerTitleVote" style = "font-size:23px; margin-top: -5; text-align: center;" >Voting Complete</p></div>
					<center><font class="lowerTitleB"><div id="voteHead">Results: <b><span id="voteLess" style="color:firebrick"></span></b> for Republican and <b><span id="voteMore" style="color:#337ab7"></span></b> for Democrat.  <b>&nbsp;&nbsp;&nbsp;<br>Outcome: </b><div id="outcome" style="visibility:hidden;"><span id="outcomeVote"></span>&nbsp;<img id="animal" src="CSS/dem.png" style="width: 16px;"> </div> <br></div></font></center>
				</div>
				<div id="dist" style="display:none; border-color: #5a90b8; border-radius: 100px;">
                    <div style="max-width:250px; margin-top:10px; margin-left: 0px; padding-top:5px; border-color: #5a90b8; border-radius: 100px;"><center><b>$<span id="sharedBerries"></span></b> is collected by the government.</center></div>
				</div>
				<div id="dist2" style="display:none; border-color: #5a90b8; border-radius: 100px;">
					<div style="max-width:250px; margin-top:10px;margin-left:0px; padding-top:5px; border-color: #5a90b8; border-radius: 100px;"><center><b>$<span id="distVal"></span></b> is distributed to every citizen. </center></div>
				</div>
			</div>
				<div id="dist3" style="display: none;background-color: #fbfdff;position: absolute;width: 200px;top: 125px;border-width: 2px;border-color: rgb(51, 122, 183);border-radius: 25px;right: 5px;border-style: dashed;">
					<div>
						<div id="dist4" style="display:none; margin:10px"> • You were taxed $<span id="shared"></span></div>
						<div id="dist5" style="display:none; margin:10px;"> • You received $<span id="distVal2"></span></div>
						<div id="dist6" style="display:none; margin-bottom:9px; margin-left:10px;"> • Your net change after taxes was <span id="netChange"></span></div>
					</div>
                </div></td></tr></table></center>
					</div>


		<!--Survey-->
		<!-- Page 1 -->
		<div id="surveyPage1" class="instructions" style = "display: none;">
			<h4><b>Survey - Page 1</b></h4>
			<br>
			<p><b>1.</b> How did you make your decisions in this study?</p>
			<textarea id="q1" rows="8" cols="55" ></textarea>
			<br>
			<br>
			<button type="button" onclick="turnPage('surveyPage1','surveyPage2')" class="btn btn-primary">Next</button>
			</div>
			<!-- Page 2 -->
			<div id="surveyPage2" class="instructions" style = "display: none;"><h4><b>Survey - Page 2</b></h4>
			<p class= "italic">Please answer the following questions about the United States government and current support for citizens who suffer economic hardships.</p>
			<p><b>2.</b> Do you think the U.S. government currently provides too little, too much, or just the right amount of benefits (money, food, housing, health care, etc.) to people who suffer economic hardships?</p>
					<select id="q2"><option selected value="blank" ></option>
				<option value="1">Far too little</option>
				<option value="2">Too little</option>
				<option value="3">Slightly too little</option>
				<option value="4">Just the right amount</option>
				<option value="5">Slightly too much</option>
				<option value="6">Too much</option>
				<option value="7">Far too much</option>
			</select></p>
			<p><b>3.</b> Do you think the U.S. government currently collects too little, too much, or just the right amount of taxes in order to provide benefits to people who suffer economic hardships?</p>
					<select id="q3"><option selected value="blank" ></option>
				<option value="1">Far too little</option>
				<option value="2">Too little</option>
				<option value="3">Slightly too little</option>
				<option value="4">Just the right amount</option>
				<option value="5">Slightly too much</option>
				<option value="6">Too much</option>
				<option value="7">Far too much</option>
			</select></p>
			<p><b>4.</b> Are you personally willing to pay more taxes to help provide benefits to people who suffer economic hardships?</p>
					<select id="q4"><option selected value="blank" ></option>
				<option value="1">Very opposed</option>
				<option value="2">Moderately opposed</option>
				<option value="3">Slightly opposed</option>
				<option value="4">Neutral</option>
				<option value="5">Slightly willing</option>
				<option value="6">Moderately willing</option>
				<option value="7">Very willing</option>
			</select></p>
			<button type="button" onclick="turnPage('surveyPage2','surveyPage1')" class="btn btn-primary">Previous</button>
			<button type="button" onclick="turnPage('surveyPage2','surveyPage3')" class="btn btn-primary">Next</button>
			</div>
			<!-- Page 3 -->
			<div id="surveyPage3" class="instructions" style = "display: none;"><h4><b>Survey - Page 3</b></h4>
				<p><b>5.</b> Generally speaking, are your political views liberal or conservative?
				<select id="q5"><option selected value="blank" ></option>
					<option value="0">Very Liberal</option>
					<option value="1">Moderately Liberal</option>
					<option value="2">Slightly Liberal</option>
					<option value="3">Neither Liberal nor Conservative</option>
					<option value="4">Slightly Conservative</option>
					<option value="5">Moderately Conservative</option>
					<option value="6">Very Conservative</option>
				</select></p>
				<p><b>6.</b>Who did you plan to vote for in the presidential election (whether or not you were able to vote)?
        <select id="q7"><option selected value="blank" ></option>
          <option value="biden">Joe Biden</option>
          <option value="trump">Donald Trump</option>
          <option value="other">Other</option>
          <option value="dnv">I did not plan to vote</option>
        </select></p>
				<p><b>7.</b> What is your sex?
				<select id="q8"><option selected value="blank" ></option>
					<option value="Female">Female</option>
					<option value="Male">Male</option>
				</select></p>
				<p><b>8.</b> What is your age? <input type="number" id="q9" value="" style="width:50px;"></p>
				<p><b>9.</b> What is your ethnicity? <input type="text" id="q10"></p>
				<p><b>10.</b> Please write any other comments about the study below.</p>
				<textarea id="q11" rows="2" cols="55" ></textarea>
				<p><br>Please submit this survey to receive your bonus through your panel company.</p>
				<button type="button" onclick="turnPage('surveyPage3','surveyPage2')" class="btn btn-primary">Previous</button>
				<button type="button" class="btn btn-primary" onclick="submitSurvey();">Submit</button>
			</div>
			</td>
<!--Giant Box that covers the page after Survey-->
<div id="bye" class="greetings" style="display: none;">
	<h2 style="color:#337ab7">Thank you for participating!</h2>
	</div>
</body></html>
